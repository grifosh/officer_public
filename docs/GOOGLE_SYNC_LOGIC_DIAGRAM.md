# Диаграмма логики определения актуальности Google Calendar

```
                    ┌─────────────────────────────────────┐
                    │        Событие в Google Calendar?    │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                НЕТ                  │
                    │         local_to_google             │
                    │      (создать в Google)             │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                 ДА                   │
                    │        Событие локально?             │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                НЕТ                  │
                    │         google_to_local             │
                    │      (создать локально)             │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                 ДА                   │
                    │        Сравнить временные метки      │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │        Нет локального времени?     │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                 ДА                  │
                    │         google_to_local             │
                    │   (Google время известно)          │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                НЕТ                   │
                    │        Нет Google времени?           │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                 ДА                  │
                    │         local_to_google             │
                    │   (локальное время известно)       │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                НЕТ                   │
                    │        Оба времени известны         │
                    │        Вычислить разницу            │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │        Разница < 1 секунды?        │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                 ДА                  │
                    │            no_change                │
                    │         (изменений нет)             │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                НЕТ                  │
                    │        Разница < 5 секунд?          │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                 ДА                  │
                    │             conflict                 │
                    │    (одновременные изменения)        │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                НЕТ                   │
                    │        Какое время новее?           │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │        local_updated > google_updated │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                 ДА                  │
                    │         local_to_google             │
                    │      (локальное новее)              │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │                НЕТ                  │
                    │         google_to_local             │
                    │        (Google новее)                │
                    └───────────────────────────────────────┘
```

## Ключевые моменты:

1. **Приоритет времени**: Более новое изменение всегда имеет приоритет
2. **Защита от конфликтов**: Разница < 5 сек = одновременные изменения
3. **Неизвестное время**: Используется доступная информация
4. **Точность**: Разница < 1 сек = нет изменений
