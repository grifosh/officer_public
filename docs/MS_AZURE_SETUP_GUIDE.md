# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Microsoft Graph API –¥–ª—è Outlook.com

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Azure Portal

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Azure Portal**: https://portal.azure.com
2. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π Microsoft –∞–∫–∫–∞—É–Ω—Ç** (—Ç–æ—Ç –∂–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–ª—è Outlook.com)
3. **–í –ø–æ–∏—Å–∫–µ –≤–≤–µ–¥–∏—Ç–µ**: `Azure Active Directory`
4. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤**: `App registrations`
5. **–ù–∞–∂–º–∏—Ç–µ**: `New registration`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:**
- **Name**: `Officer Calendar App`
- **Supported account types**: `Accounts in any organizational directory and personal Microsoft accounts`
- **Redirect URI**: `http://localhost:8080/auth/callback`

**–ù–∞–∂–º–∏—Ç–µ**: `Register`

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "Overview" —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ:

- **Application (client) ID** ‚Üí —ç—Ç–æ –≤–∞—à `CLIENT_ID`
- **Directory (tenant) ID** ‚Üí —ç—Ç–æ –≤–∞—à `TENANT_ID`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤**: `API permissions`
2. **–ù–∞–∂–º–∏—Ç–µ**: `Add a permission`
3. **–í—ã–±–µ—Ä–∏—Ç–µ**: `Microsoft Graph`
4. **–í—ã–±–µ—Ä–∏—Ç–µ**: `Delegated permissions`
5. **–î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è**:
   - `Calendars.ReadWrite` - —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π
   - `User.Read` - —á—Ç–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. **–ù–∞–∂–º–∏—Ç–µ**: `Add permissions`
7. **–ù–∞–∂–º–∏—Ç–µ**: `Grant admin consent` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

### 5. –°–æ–∑–¥–∞–Ω–∏–µ Client Secret (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤**: `Certificates & secrets`
2. **–ù–∞–∂–º–∏—Ç–µ**: `New client secret`
3. **–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ**: `Officer Calendar Secret`
4. **–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**: `24 months`
5. **–ù–∞–∂–º–∏—Ç–µ**: `Add`
6. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ "Value"** ‚Üí —ç—Ç–æ –≤–∞—à `CLIENT_SECRET`

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª**: `test_azure_credentials.py`
2. **–ó–∞–º–µ–Ω–∏—Ç–µ**:
   ```python
   CLIENT_ID = "YOUR_CLIENT_ID_HERE"  # –í–∞—à Application (client) ID
   TENANT_ID = "YOUR_TENANT_ID_HERE"  # –í–∞—à Directory (tenant) ID
   CLIENT_SECRET = "YOUR_CLIENT_SECRET_HERE"  # –í–∞—à Client Secret
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç**:
   ```bash
   python test_azure_credentials.py
   ```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
MICROSOFT_CLIENT_ID=your_client_id_here
MICROSOFT_CLIENT_SECRET=your_client_secret_here
MICROSOFT_TENANT_ID=your_tenant_id_here
MICROSOFT_SYNC_ENABLED=true
MICROSOFT_SYNC_INTERVAL=300
```

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
# –¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
python test_azure_credentials.py

# –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
curl http://localhost:5001/api/microsoft-graph/status
```

## ‚ùó –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–î–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ Microsoft** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `TENANT_ID = "common"`
2. **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **Client Secret** –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
4. **–¢–æ–∫–µ–Ω—ã** —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `microsoft_token.pickle`

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Client ID
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –£–¥–∞–ª–∏—Ç–µ `microsoft_token.pickle` –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

### –û—à–∏–±–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è `Calendars.ReadWrite`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã (Grant admin consent)

### –û—à–∏–±–∫–∞ API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Microsoft Graph API –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
